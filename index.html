<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cabi Invitation Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#fff; --text:#111; --muted:#6b7280; --card:#f6f7f9; --border:#e5e7eb; }
    body { font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; color:var(--text);
           background:var(--bg); max-width:780px; margin:2rem auto; padding:0 1rem; }
    h1 { margin:0 0 1rem 0; font-weight:700; }
    .card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:1rem; }
    label { display:block; margin:.75rem 0 .25rem; font-weight:600; }
    input, select, button {
      width:100%; padding:.65rem .75rem; border:1px solid #d1d5db; border-radius:10px; font:inherit; box-sizing:border-box;
    }
    input:focus, select:focus, button:focus { outline:2px solid #111; outline-offset:2px; }
    .row { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .actions { display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.75rem; }
    button { cursor:pointer; background:#111; color:#fff; border:none; }
    button.secondary { background:#e5e7eb; color:#111; }
    pre { white-space:pre-wrap; background:#fff; border:1px solid var(--border); border-radius:10px; padding:1rem; min-height:9rem; }
    .muted { color:var(--muted); font-size:.9rem; }
  </style>
</head>
<body>
  <h1>Cabi Invitation Generator</h1>

  <div class="card">
    <form id="f">
      <div class="row">
        <div>
          <label>Customer name</label>
          <input id="name" placeholder="Sumanth" required />
        </div>
        <div>
          <label>Event</label>
          <input id="event" placeholder="Rams House Soirée" required />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Tone</label>
          <select id="tone">
            <option>Warm & Polished</option><option>Playful & Fun</option><option>Elevated & Elegant</option>
            <option>Casual & Friendly</option><option>Luxe Concierge</option><option>Minimal & Modern</option>
            <option>Bold & Joyful</option><option>Romantic & Chic</option><option>Laid-Back & Conversational</option>
            <option>VIP Personal Stylist</option>
          </select>
        </div>
        <div>
          <label>Collection (optional)</label>
          <select id="collection">
            <option value="">(none)</option><option>Spring Edit</option><option>Summer Edit</option>
            <option>Fall Edit</option><option>Holiday Edit</option><option>Just In</option>
            <option>Everyday Essentials</option>
          </select>
        </div>
      </div>

      <label>Sign-off</label>
      <input id="stylist" value="Your Cabi Stylist" />

      <div class="actions">
        <button id="generateBtn" type="submit">Generate</button>
        <button id="copyBtn" class="secondary" type="button">Copy</button>
        <button id="downloadBtn" class="secondary" type="button">Download .txt</button>
        <button id="emailBtn" class="secondary" type="button">Email draft</button>
      </div>

      <p class="muted">Tip: try different tones & collections for varied language.</p>
    </form>
  </div>

  <h3>Result</h3>
  <pre id="out">—</pre>

  <script>
    // TODO: paste your live Pipedream webhook URL here:
    const PD_URL = "https://eocb0l4zskm1aad.m.pipedream.net";

    const f = document.getElementById("f");
    const out = document.getElementById("out");
    const generateBtn = document.getElementById("generateBtn");
    const copyBtn = document.getElementById("copyBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const emailBtn = document.getElementById("emailBtn");

    f.addEventListener("submit", async (e) => {
      e.preventDefault();

      const payload = {
        name: document.getElementById("name").value.trim(),
        event: document.getElementById("event").value.trim(),
        tone: document.getElementById("tone").value,
        collection: document.getElementById("collection").value || null,
        stylist: document.getElementById("stylist").value.trim() || "Your Cabi Stylist"
      };
      if (!payload.name || !payload.event) {
        out.textContent = "Please fill in Name and Event.";
        return;
      }

      try {
        generateBtn.disabled = true;
        generateBtn.textContent = "Generating…";
        out.textContent = "Generating…";

        const r = await fetch(PD_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const text = await r.text();   // read as text first (helps debug non-JSON)
        let data;
        try { data = JSON.parse(text); }
        catch (err) { throw new Error("Expected JSON, got:\n" + text.slice(0, 400)); }

        out.textContent = data.invitation || JSON.stringify(data, null, 2);
      } catch (err) {
        out.textContent = "Error: " + err.message + "\nCheck Pipedream response and CORS headers.";
      } finally {
        generateBtn.disabled = false;
        generateBtn.textContent = "Generate";
      }
    });

    copyBtn.addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(out.textContent || "");
        copyBtn.textContent = "Copied!";
        setTimeout(() => (copyBtn.textContent = "Copy"), 900);
      } catch { /* ignore */ }
    });

    downloadBtn.addEventListener("click", () => {
      const blob = new Blob([out.textContent || ""], { type: "text/plain" });
      const url = (window.URL || window.webkitURL).createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "cabi_invitation.txt";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => (window.URL || window.webkitURL).revokeObjectURL(url), 500);
    });

    emailBtn.addEventListener("click", () => {
      const full = out.textContent || "";
      const first = (full.split("\n")[0] || "").replace(/^Subject:\s*/i,"").trim();
      const subject = encodeURIComponent(first || "Cabi Invitation");
      const body = encodeURIComponent(full);
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    });
  </script>
</body>
</html>
